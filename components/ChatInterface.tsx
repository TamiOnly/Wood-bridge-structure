'use client'

import { useState, useRef, useEffect } from 'react'
import { useAppStore } from '@/lib/store'
// import { toast } from 'react-hot-toast'
import { 
  Send, 
  Bot, 
  User, 
  Lightbulb, 
  BookOpen, 
  Calculator,
  Zap,
  HelpCircle
} from 'lucide-react'

export default function ChatInterface() {
  const { chatMessages, addChatMessage } = useAppStore()
  const [inputMessage, setInputMessage] = useState('')
  const [isTyping, setIsTyping] = useState(false)
  const messagesEndRef = useRef<HTMLDivElement>(null)

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })
  }

  useEffect(() => {
    scrollToBottom()
  }, [chatMessages])

  // é¢„è®¾é—®é¢˜æ¨¡æ¿
  const quickQuestions = [
    {
      icon: Lightbulb,
      text: 'æ¡¥æ¢ç»“æ„æœ‰å“ªäº›ç±»å‹ï¼Ÿ',
      category: 'åŸºç¡€æ¦‚å¿µ'
    },
    {
      icon: Calculator,
      text: 'å¦‚ä½•è®¡ç®—æ¡¥æ¢çš„æ‰¿é‡èƒ½åŠ›ï¼Ÿ',
      category: 'è®¡ç®—æ–¹æ³•'
    },
    {
      icon: BookOpen,
      text: 'æœ¨ç»“æ„æ¡¥æ¢çš„è®¾è®¡åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ',
      category: 'è®¾è®¡åŸç†'
    },
    {
      icon: Zap,
      text: 'å¦‚ä½•æé«˜æ¡¥æ¢çš„ç¨³å®šæ€§ï¼Ÿ',
      category: 'ä¼˜åŒ–å»ºè®®'
    },
    {
      icon: HelpCircle,
      text: 'æ¡¥æ¢è®¾è®¡æ—¶éœ€è¦è€ƒè™‘å“ªäº›è·è½½ï¼Ÿ',
      category: 'è·è½½åˆ†æ'
    },
    {
      icon: Lightbulb,
      text: 'å¦‚ä½•é€‰æ‹©åˆé€‚çš„æœ¨æï¼Ÿ',
      category: 'ææ–™é€‰æ‹©'
    },
    {
      icon: Calculator,
      text: 'æ¡¥æ¢è·¨åº¦ä¸ææ–™ç”¨é‡çš„å…³ç³»ï¼Ÿ',
      category: 'ç»æµåˆ†æ'
    },
    {
      icon: BookOpen,
      text: 'æ¡¥æ¢æ–½å·¥ä¸­éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ',
      category: 'æ–½å·¥è¦ç‚¹'
    }
  ]

  // æ™ºèƒ½å›ç­”ç³»ç»Ÿ
  const getAIResponse = (question: string): string => {
    const lowerQuestion = question.toLowerCase()
    
    // é—®å€™è¯­å’Œç®€å•é—®é¢˜
    if (lowerQuestion.includes('ä½ å¥½') || lowerQuestion.includes('hello') || lowerQuestion.includes('hi')) {
      return `ä½ å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ¡¥æ¢å­¦ä¹ åŠ©æ‰‹ ğŸ¤–

å¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼æˆ‘å¯ä»¥å¸®åŠ©æ‚¨ï¼š
â€¢ è§£ç­”æ¡¥æ¢å·¥ç¨‹ç›¸å…³é—®é¢˜
â€¢ æä¾›ç»“æ„åŠ›å­¦çŸ¥è¯†
â€¢ æŒ‡å¯¼ææ–™é€‰æ‹©
â€¢ åˆ†æè®¾è®¡åŸç†
â€¢ ç»™å‡ºå­¦ä¹ å»ºè®®

è¯·å‘Šè¯‰æˆ‘æ‚¨æƒ³äº†è§£ä»€ä¹ˆï¼Œæˆ‘ä¼šå°½åŠ›ä¸ºæ‚¨è¯¦ç»†è§£ç­”ï¼`
    }

    // æ„Ÿè°¢å’Œç»“æŸè¯­
    if (lowerQuestion.includes('è°¢è°¢') || lowerQuestion.includes('thank') || lowerQuestion.includes('å†è§')) {
      return `ä¸å®¢æ°”ï¼å¾ˆé«˜å…´èƒ½å¸®åŠ©æ‚¨å­¦ä¹ æ¡¥æ¢å·¥ç¨‹çŸ¥è¯† ğŸŒ‰

å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œéšæ—¶å¯ä»¥é—®æˆ‘ã€‚ç¥æ‚¨å­¦ä¹ æ„‰å¿«ï¼

è®°ä½ï¼š
â€¢ å®è·µæ˜¯å­¦ä¹ çš„æœ€å¥½æ–¹æ³•
â€¢ å¤šåŠ¨æ‰‹è®¾è®¡ï¼Œå¤šæ€è€ƒåŸç†
â€¢ é‡åˆ°é—®é¢˜ä¸è¦æ€•ï¼Œæˆ‘ä»¬ä¸€èµ·è§£å†³ï¼`
    }

    // æ¡¥æ¢ç±»å‹ç›¸å…³
    if (lowerQuestion.includes('æ¡¥æ¢') && (lowerQuestion.includes('ç±»å‹') || lowerQuestion.includes('ç§ç±»') || lowerQuestion.includes('åˆ†ç±»'))) {
      return `æ¡¥æ¢ç»“æ„ä¸»è¦åˆ†ä¸ºå››å¤§ç±»å‹ï¼š

ğŸŒ‰ **æ¢æ¡¥**ï¼šæœ€ç®€å•çš„ç»“æ„ï¼Œé€‚åˆçŸ­è·¨å¾„
- ä¼˜ç‚¹ï¼šç»“æ„ç®€å•ï¼Œæ–½å·¥å®¹æ˜“
- ç¼ºç‚¹ï¼šè·¨å¾„æœ‰é™ï¼Œæ‰¿é‡èƒ½åŠ›ç›¸å¯¹è¾ƒä½

ğŸŒ‰ **æ‹±æ¡¥**ï¼šç¾è§‚ä¸”åšå›ºï¼Œé€‚åˆä¸­ç­‰è·¨å¾„
- ä¼˜ç‚¹ï¼šæ‰¿é‡èƒ½åŠ›å¼ºï¼Œé€ å‹ç¾è§‚
- ç¼ºç‚¹ï¼šæ–½å·¥å¤æ‚ï¼Œå¯¹åœ°åŸºè¦æ±‚é«˜

ğŸŒ‰ **æ¡æ¶æ¡¥**ï¼šç»“æ„ç¨³å®šï¼Œé€‚åˆé•¿è·¨å¾„
- ä¼˜ç‚¹ï¼šææ–™åˆ©ç”¨ç‡é«˜ï¼Œè·¨åº¦å¤§
- ç¼ºç‚¹ï¼šç»“æ„å¤æ‚ï¼Œç»´æŠ¤æˆæœ¬é«˜

ğŸŒ‰ **æ‚¬ç´¢æ¡¥**ï¼šè·¨åº¦æœ€å¤§ï¼ŒæŠ€æœ¯æœ€å¤æ‚
- ä¼˜ç‚¹ï¼šè·¨åº¦å¯è¾¾æ•°åƒç±³
- ç¼ºç‚¹ï¼šé€ ä»·æ˜‚è´µï¼ŒæŠ€æœ¯è¦æ±‚é«˜

å¯¹äºæœ¨ç»“æ„æ¡¥æ¢ï¼Œå»ºè®®ä»æ¢æ¡¥å¼€å§‹å­¦ä¹ ï¼Œé€æ­¥æŒæ¡æ›´å¤æ‚çš„ç»“æ„ç±»å‹ã€‚`
    }

    // æ‰¿é‡è®¡ç®—ç›¸å…³
    if (lowerQuestion.includes('æ‰¿é‡') || lowerQuestion.includes('è®¡ç®—')) {
      return `æ¡¥æ¢æ‰¿é‡èƒ½åŠ›è®¡ç®—æ¶‰åŠå¤šä¸ªå› ç´ ï¼š

ğŸ“Š **ä¸»è¦å½±å“å› ç´ **ï¼š
1. **ææ–™å¼ºåº¦**ï¼šä¸åŒæœ¨æçš„å¼ºåº¦å·®å¼‚å¾ˆå¤§
2. **æˆªé¢å½¢çŠ¶**ï¼šçŸ©å½¢ã€åœ†å½¢ã€å·¥å­—å½¢ç­‰
3. **æ”¯æ’‘æ–¹å¼**ï¼šç®€æ”¯ã€è¿ç»­ã€æ‚¬è‡‚ç­‰
4. **è·è½½åˆ†å¸ƒ**ï¼šé›†ä¸­è·è½½ vs åˆ†å¸ƒè·è½½

ğŸ§® **åŸºæœ¬è®¡ç®—å…¬å¼**ï¼š
- å¼¯çŸ© M = P Ã— L / 4 (ç®€æ”¯æ¢ä¸­ç‚¹é›†ä¸­è·è½½)
- åº”åŠ› Ïƒ = M Ã— y / I
- å®‰å…¨ç³»æ•° = ææ–™å¼ºåº¦ / å®é™…åº”åŠ›

ğŸ’¡ **å®ç”¨å»ºè®®**ï¼š
- å¢åŠ æˆªé¢é«˜åº¦æ¯”å¢åŠ å®½åº¦æ›´æœ‰æ•ˆ
- åˆç†å¸ƒç½®æ”¯æ’‘ç‚¹å¯æ˜¾è‘—æé«˜æ‰¿é‡
- è€ƒè™‘ææ–™çš„å„å‘å¼‚æ€§ç‰¹æ€§

å»ºè®®å…ˆç”¨ç®€å•æ¨¡å‹éªŒè¯ç†è®ºè®¡ç®—ï¼Œå†é€æ­¥å¢åŠ å¤æ‚åº¦ã€‚`
    }

    // è®¾è®¡åŸç†ç›¸å…³
    if (lowerQuestion.includes('è®¾è®¡') && lowerQuestion.includes('åŸç†')) {
      return `æœ¨ç»“æ„æ¡¥æ¢è®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸç†ï¼š

ğŸ—ï¸ **ç»“æ„åŠ›å­¦åŸç†**ï¼š
1. **åŠ›çš„ä¼ é€’è·¯å¾„**ï¼šè·è½½ â†’ æ¡¥é¢ â†’ ä¸»æ¢ â†’ æ”¯æ’‘ â†’ åŸºç¡€
2. **åº”åŠ›åˆ†å¸ƒ**ï¼šä¸Šå¼¦å—å‹ï¼Œä¸‹å¼¦å—æ‹‰ï¼Œè…¹æ†ä¼ é€’å‰ªåŠ›
3. **ç¨³å®šæ€§**ï¼šé˜²æ­¢ä¾§å‘å¤±ç¨³å’Œæ‰­è½¬å¤±ç¨³

ğŸŒ² **ææ–™ç‰¹æ€§è€ƒè™‘**ï¼š
- **é¡ºçº¹å¼ºåº¦** > **æ¨ªçº¹å¼ºåº¦** > **æ–œçº¹å¼ºåº¦**
- æœ¨æçš„**å„å‘å¼‚æ€§**ç‰¹æ€§
- **æ¹¿åº¦**å’Œ**æ¸©åº¦**å¯¹å¼ºåº¦çš„å½±å“

âš–ï¸ **è®¾è®¡åŸåˆ™**ï¼š
1. **å®‰å…¨ç¬¬ä¸€**ï¼šç¡®ä¿ç»“æ„å®‰å…¨å¯é 
2. **ç»æµåˆç†**ï¼šåœ¨æ»¡è¶³åŠŸèƒ½çš„å‰æä¸‹é™ä½æˆæœ¬
3. **ç¾è§‚å®ç”¨**ï¼šå…¼é¡¾ç»“æ„ç¾å’Œå®ç”¨æ€§
4. **æ–½å·¥å¯è¡Œ**ï¼šè€ƒè™‘å®é™…æ–½å·¥æ¡ä»¶

ğŸ¯ **è®¾è®¡æ­¥éª¤**ï¼š
1. ç¡®å®šè·è½½å’Œè·¨åº¦
2. é€‰æ‹©ç»“æ„å½¢å¼
3. åˆæ­¥è®¾è®¡æˆªé¢
4. ç»“æ„åˆ†æè®¡ç®—
5. ä¼˜åŒ–è®¾è®¡å‚æ•°
6. ç»˜åˆ¶æ–½å·¥å›¾çº¸`
    }

    // ç¨³å®šæ€§ç›¸å…³
    if (lowerQuestion.includes('ç¨³å®š') || lowerQuestion.includes('ä¼˜åŒ–')) {
      return `æé«˜æ¡¥æ¢ç¨³å®šæ€§çš„æ–¹æ³•ï¼š

ğŸ”§ **ç»“æ„ä¼˜åŒ–**ï¼š
1. **å¢åŠ æ”¯æ’‘ç‚¹**ï¼šå‡å°‘å•è·¨é•¿åº¦
2. **åŠ å¼ºè¿æ¥**ï¼šä½¿ç”¨æ›´ç‰¢å›ºçš„è¿æ¥æ–¹å¼
3. **è®¾ç½®æ¨ªæ’‘**ï¼šé˜²æ­¢ä¾§å‘å˜å½¢
4. **åˆç†å¸ƒç½®**ï¼šè·è½½å°½é‡é è¿‘æ”¯æ’‘ç‚¹

ğŸ“ **å‡ ä½•ä¼˜åŒ–**ï¼š
- **é«˜å®½æ¯”**ï¼šæ¢é«˜ä¸è·¨åº¦çš„æ¯”å€¼è¦åˆç†
- **æˆªé¢å½¢çŠ¶**ï¼šå·¥å­—å½¢æ¯”çŸ©å½¢æ›´ç»æµ
- **æ”¯æ’‘è§’åº¦**ï¼šæ–œæ’‘è§’åº¦å½±å“ä¼ åŠ›æ•ˆæœ

ğŸ”— **è¿æ¥ä¼˜åŒ–**ï¼š
- ä½¿ç”¨**æ¦«å¯è¿æ¥**æé«˜èŠ‚ç‚¹å¼ºåº¦
- å¢åŠ **èºæ “**æˆ–**é’‰å­**æ•°é‡
- é‡‡ç”¨**èƒ¶åˆ**æŠ€æœ¯å¢å¼ºè¿æ¥

âš¡ **åŠ¨æ€ç¨³å®šæ€§**ï¼š
- é¿å…**å…±æŒ¯**ç°è±¡
- è€ƒè™‘**é£è·è½½**å½±å“
- è®¾ç½®**é˜»å°¼**è£…ç½®

ğŸ’¡ **å®ç”¨æŠ€å·§**ï¼š
- åœ¨å…³é”®èŠ‚ç‚¹å¤„åŠ å¼º
- ä½¿ç”¨ä¸‰è§’å½¢ç»“æ„å¢åŠ ç¨³å®šæ€§
- è€ƒè™‘æ–½å·¥è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ”¯æ’‘`
    }

    // ææ–™é€‰æ‹©ç›¸å…³
    if (lowerQuestion.includes('ææ–™') || lowerQuestion.includes('æœ¨æ') || lowerQuestion.includes('é€‰æ‹©')) {
      return `æœ¨ç»“æ„æ¡¥æ¢ææ–™é€‰æ‹©æŒ‡å—ï¼š

ğŸŒ² **å¸¸ç”¨æœ¨æç‰¹æ€§**ï¼š

**æ¾æœ¨**ï¼š
- ä¼˜ç‚¹ï¼šä»·æ ¼ä¾¿å®œï¼Œæ˜“åŠ å·¥ï¼Œé‡é‡è½»
- ç¼ºç‚¹ï¼šå¼ºåº¦è¾ƒä½ï¼Œæ˜“å˜å½¢
- é€‚ç”¨ï¼šå°å‹æ¡¥æ¢ï¼Œå­¦ä¹ å®éªŒ

**æ©¡æœ¨**ï¼š
- ä¼˜ç‚¹ï¼šå¼ºåº¦é«˜ï¼Œè€ä¹…æ€§å¥½ï¼Œçº¹ç†ç¾è§‚
- ç¼ºç‚¹ï¼šä»·æ ¼è¾ƒé«˜ï¼ŒåŠ å·¥éš¾åº¦å¤§
- é€‚ç”¨ï¼šé‡è¦ç»“æ„ï¼Œé•¿æœŸä½¿ç”¨

**ç«¹æ**ï¼š
- ä¼˜ç‚¹ï¼šå¼ºåº¦é‡é‡æ¯”é«˜ï¼ŒéŸ§æ€§å¥½ï¼Œç¯ä¿
- ç¼ºç‚¹ï¼šæ˜“å¼€è£‚ï¼Œè¿æ¥å›°éš¾
- é€‚ç”¨ï¼šè½»å‹ç»“æ„ï¼Œåˆ›æ–°è®¾è®¡

**èƒ¶åˆæ¿**ï¼š
- ä¼˜ç‚¹ï¼šå°ºå¯¸ç¨³å®šï¼Œå¼ºåº¦å‡åŒ€ï¼Œæ˜“åŠ å·¥
- ç¼ºç‚¹ï¼šè€æ°´æ€§å·®ï¼Œä»·æ ¼è¾ƒé«˜
- é€‚ç”¨ï¼šæ¡¥é¢æ¿ï¼Œè£…é¥°æ„ä»¶

ğŸ“‹ **é€‰æ‹©åŸåˆ™**ï¼š
1. **å¼ºåº¦è¦æ±‚**ï¼šæ ¹æ®è·è½½å¤§å°é€‰æ‹©
2. **è€ä¹…æ€§**ï¼šè€ƒè™‘ä½¿ç”¨ç¯å¢ƒ
3. **åŠ å·¥æ€§**ï¼šé€‰æ‹©æ˜“åŠ å·¥çš„ææ–™
4. **ç»æµæ€§**ï¼šå¹³è¡¡æ€§èƒ½ä¸æˆæœ¬
5. **ç¯ä¿æ€§**ï¼šé€‰æ‹©å¯æŒç»­ææ–™`
    }

    // è·è½½åˆ†æç›¸å…³
    if (lowerQuestion.includes('è·è½½') || lowerQuestion.includes('åŠ›') || lowerQuestion.includes('å‹åŠ›')) {
      return `æ¡¥æ¢è®¾è®¡ä¸­çš„è·è½½åˆ†æï¼š

âš–ï¸ **ä¸»è¦è·è½½ç±»å‹**ï¼š

**æ’è½½ï¼ˆDead Loadï¼‰**ï¼š
- æ¡¥æ¢è‡ªé‡ï¼šç»“æ„ææ–™é‡é‡
- é™„å±è®¾æ–½ï¼šæ æ†ã€è·¯é¢ã€ç®¡çº¿ç­‰
- ç‰¹ç‚¹ï¼šå¤§å°å’Œä½ç½®å›ºå®šä¸å˜

**æ´»è½½ï¼ˆLive Loadï¼‰**ï¼š
- è½¦è¾†è·è½½ï¼šæ±½è½¦ã€å¡è½¦é‡é‡
- äººç¾¤è·è½½ï¼šè¡Œäººé‡é‡
- ç‰¹ç‚¹ï¼šå¤§å°å’Œä½ç½®å˜åŒ–

**ç¯å¢ƒè·è½½**ï¼š
- é£è·è½½ï¼šä¾§å‘é£åŠ›ä½œç”¨
- æ¸©åº¦è·è½½ï¼šçƒ­èƒ€å†·ç¼©æ•ˆåº”
- åœ°éœ‡è·è½½ï¼šåœ°éœ‡æƒ¯æ€§åŠ›

ğŸ“Š **è·è½½ç»„åˆ**ï¼š
1. **åŸºæœ¬ç»„åˆ**ï¼šæ’è½½ + æ´»è½½
2. **æ ‡å‡†ç»„åˆ**ï¼šåŸºæœ¬ç»„åˆ + é£è½½
3. **å¶ç„¶ç»„åˆ**ï¼šæ ‡å‡†ç»„åˆ + åœ°éœ‡

ğŸ” **åˆ†ææ–¹æ³•**ï¼š
- **é™åŠ›åˆ†æ**ï¼šè®¡ç®—é™åŠ›å¹³è¡¡
- **åŠ¨åŠ›åˆ†æ**ï¼šè€ƒè™‘æŒ¯åŠ¨æ•ˆåº”
- **ç–²åŠ³åˆ†æ**ï¼šé‡å¤è·è½½å½±å“

ğŸ’¡ **è®¾è®¡å»ºè®®**ï¼š
- å®‰å…¨ç³»æ•°é€šå¸¸å–2.0-3.0
- è€ƒè™‘è·è½½çš„ä¸ç¡®å®šæ€§
- é¢„ç•™ä¸€å®šçš„å®‰å…¨ä½™é‡`
    }

    // ç»æµåˆ†æç›¸å…³
    if (lowerQuestion.includes('è·¨åº¦') || lowerQuestion.includes('ææ–™ç”¨é‡') || lowerQuestion.includes('ç»æµ')) {
      return `æ¡¥æ¢è·¨åº¦ä¸ææ–™ç”¨é‡çš„ç»æµåˆ†æï¼š

ğŸ“ **è·¨åº¦ä¸ææ–™å…³ç³»**ï¼š

**æ¢æ¡¥**ï¼š
- ææ–™ç”¨é‡ âˆ è·¨åº¦Â²
- è·¨å¾„å¢åŠ 1å€ï¼Œææ–™å¢åŠ 4å€
- ç»æµè·¨åº¦ï¼š10-30ç±³

**æ‹±æ¡¥**ï¼š
- ææ–™ç”¨é‡ âˆ è·¨åº¦^1.5
- è·¨å¾„å¢åŠ 1å€ï¼Œææ–™å¢åŠ 2.8å€
- ç»æµè·¨åº¦ï¼š20-100ç±³

**æ¡æ¶æ¡¥**ï¼š
- ææ–™ç”¨é‡ âˆ è·¨åº¦^1.2
- è·¨å¾„å¢åŠ 1å€ï¼Œææ–™å¢åŠ 2.3å€
- ç»æµè·¨åº¦ï¼š30-200ç±³

ğŸ’° **æˆæœ¬æ„æˆ**ï¼š
1. **ææ–™æˆæœ¬**ï¼š40-60%
2. **äººå·¥æˆæœ¬**ï¼š20-30%
3. **è®¾å¤‡æˆæœ¬**ï¼š10-20%
4. **å…¶ä»–è´¹ç”¨**ï¼š10-20%

ğŸ“Š **ä¼˜åŒ–ç­–ç•¥**ï¼š
- **åˆç†åˆ†è·¨**ï¼šé¿å…è¿‡å¤§å•è·¨
- **ææ–™é€‰æ‹©**ï¼šå¹³è¡¡å¼ºåº¦ä¸æˆæœ¬
- **ç»“æ„å½¢å¼**ï¼šé€‰æ‹©ç»æµç»“æ„
- **æ–½å·¥æ–¹æ³•**ï¼šé™ä½æ–½å·¥æˆæœ¬

ğŸ¯ **ç»æµæŒ‡æ ‡**ï¼š
- å•ä½è·¨åº¦æˆæœ¬ï¼ˆå…ƒ/ç±³ï¼‰
- ææ–™åˆ©ç”¨ç‡ï¼ˆ%ï¼‰
- æ–½å·¥å‘¨æœŸï¼ˆå¤©ï¼‰
- ç»´æŠ¤æˆæœ¬ï¼ˆå¹´ï¼‰`
    }

    // æ–½å·¥è¦ç‚¹ç›¸å…³
    if (lowerQuestion.includes('æ–½å·¥') || lowerQuestion.includes('å»ºé€ ') || lowerQuestion.includes('åˆ¶ä½œ')) {
      return `æ¡¥æ¢æ–½å·¥ä¸­çš„å…³é”®è¦ç‚¹ï¼š

ğŸ”¨ **æ–½å·¥å‡†å¤‡**ï¼š
1. **åœºåœ°å¹³æ•´**ï¼šç¡®ä¿åŸºç¡€ç¨³å›º
2. **ææ–™å‡†å¤‡**ï¼šæ£€æŸ¥ææ–™è´¨é‡
3. **å·¥å…·å‡†å¤‡**ï¼šé”¯å­ã€é’»å¤´ã€èƒ¶æ°´ç­‰
4. **å®‰å…¨æªæ–½**ï¼šä½©æˆ´é˜²æŠ¤ç”¨å“

ğŸ“ **æµ‹é‡æ”¾æ ·**ï¼š
- ä½¿ç”¨ç²¾ç¡®æµ‹é‡å·¥å…·
- æ ‡è®°å…³é”®æ§åˆ¶ç‚¹
- æ£€æŸ¥å‡ ä½•å°ºå¯¸
- ç¡®ä¿å¯¹ç§°æ€§

ğŸ”— **è¿æ¥å·¥è‰º**ï¼š
**æ¦«å¯è¿æ¥**ï¼š
- ä¼˜ç‚¹ï¼šå¼ºåº¦é«˜ï¼Œç¾è§‚
- ç¼ºç‚¹ï¼šåŠ å·¥å¤æ‚
- é€‚ç”¨ï¼šé‡è¦èŠ‚ç‚¹

**èºæ “è¿æ¥**ï¼š
- ä¼˜ç‚¹ï¼šæ–½å·¥ç®€å•ï¼Œå¯æ‹†å¸
- ç¼ºç‚¹ï¼šéœ€è¦é¢„é’»å­”
- é€‚ç”¨ï¼šä¸´æ—¶ç»“æ„

**èƒ¶åˆè¿æ¥**ï¼š
- ä¼˜ç‚¹ï¼šå¼ºåº¦å‡åŒ€ï¼Œå¯†å°å¥½
- ç¼ºç‚¹ï¼šå›ºåŒ–æ—¶é—´é•¿
- é€‚ç”¨ï¼šå¤§é¢ç§¯è¿æ¥

âš ï¸ **è´¨é‡æ§åˆ¶**ï¼š
1. **ææ–™æ£€æŸ¥**ï¼šæ— è£‚çº¹ã€æ— è™«è›€
2. **å°ºå¯¸æ£€æŸ¥**ï¼šè¯¯å·®æ§åˆ¶åœ¨Â±2mm
3. **è¿æ¥æ£€æŸ¥**ï¼šç‰¢å›ºå¯é 
4. **æ•´ä½“æ£€æŸ¥**ï¼šç»“æ„ç¨³å®š

ğŸš§ **å®‰å…¨æ³¨æ„äº‹é¡¹**ï¼š
- ä½¿ç”¨é”‹åˆ©å·¥å…·æ—¶æ³¨æ„å®‰å…¨
- èƒ¶æ°´ä½¿ç”¨ååŠæ—¶æ´—æ‰‹
- ä¿æŒå·¥ä½œåŒºåŸŸæ•´æ´
- éµå®ˆå®éªŒå®¤å®‰å…¨è§„å®š`
    }

    // ç»“æ„åŠ›å­¦ç›¸å…³
    if (lowerQuestion.includes('åŠ›') || lowerQuestion.includes('åº”åŠ›') || lowerQuestion.includes('å¼¯çŸ©') || lowerQuestion.includes('å‰ªåŠ›')) {
      return `ç»“æ„åŠ›å­¦åŸºç¡€çŸ¥è¯†ï¼š

ğŸ”§ **åŠ›çš„åŸºæœ¬æ¦‚å¿µ**ï¼š
â€¢ **æ‹‰åŠ›**ï¼šä½¿ææ–™ä¼¸é•¿çš„åŠ›
â€¢ **å‹åŠ›**ï¼šä½¿ææ–™å‹ç¼©çš„åŠ›  
â€¢ **å‰ªåŠ›**ï¼šä½¿ææ–™äº§ç”Ÿå‰ªåˆ‡å˜å½¢çš„åŠ›
â€¢ **å¼¯çŸ©**ï¼šä½¿ææ–™å¼¯æ›²çš„åŠ›çŸ©

ğŸ“ **åº”åŠ›åˆ†æ**ï¼š
â€¢ åº”åŠ› = åŠ› / æˆªé¢é¢ç§¯
â€¢ å®‰å…¨ç³»æ•° = ææ–™å¼ºåº¦ / å®é™…åº”åŠ›
â€¢ é€šå¸¸å®‰å…¨ç³»æ•°å–2.0-3.0

ğŸ’¡ **å®ç”¨å»ºè®®**ï¼š
â€¢ æ¢çš„ä¸Šéƒ¨å—å‹ï¼Œä¸‹éƒ¨å—æ‹‰
â€¢ å¢åŠ æˆªé¢é«˜åº¦æ¯”å¢åŠ å®½åº¦æ›´æœ‰æ•ˆ
â€¢ åˆç†å¸ƒç½®æ”¯æ’‘ç‚¹å¯å‡å°‘å¼¯çŸ©

å»ºè®®ä»ç®€å•çš„æ¢æ¡¥å¼€å§‹å­¦ä¹ å—åŠ›åˆ†æï¼`
    }

    // ææ–™ç§‘å­¦ç›¸å…³
    if (lowerQuestion.includes('ææ–™') || lowerQuestion.includes('æœ¨æ') || lowerQuestion.includes('å¼ºåº¦') || lowerQuestion.includes('å¼¹æ€§')) {
      return `ææ–™ç§‘å­¦åŸºç¡€çŸ¥è¯†ï¼š

ğŸŒ² **æœ¨æç‰¹æ€§**ï¼š
â€¢ **å„å‘å¼‚æ€§**ï¼šé¡ºçº¹å¼ºåº¦ > æ¨ªçº¹å¼ºåº¦
â€¢ **å¼¹æ€§æ¨¡é‡**ï¼šææ–™æŠµæŠ—å˜å½¢çš„èƒ½åŠ›
â€¢ **å¼ºåº¦**ï¼šææ–™èƒ½æ‰¿å—çš„æœ€å¤§åº”åŠ›
â€¢ **éŸ§æ€§**ï¼šææ–™æŠµæŠ—å†²å‡»çš„èƒ½åŠ›

ğŸ“Š **ææ–™é€‰æ‹©åŸåˆ™**ï¼š
1. **å¼ºåº¦è¦æ±‚**ï¼šæ ¹æ®è·è½½å¤§å°é€‰æ‹©
2. **åˆšåº¦è¦æ±‚**ï¼šæ§åˆ¶å˜å½¢åœ¨å…è®¸èŒƒå›´å†…
3. **è€ä¹…æ€§**ï¼šè€ƒè™‘ä½¿ç”¨ç¯å¢ƒ
4. **ç»æµæ€§**ï¼šå¹³è¡¡æ€§èƒ½ä¸æˆæœ¬

ğŸ”¬ **å®éªŒå»ºè®®**ï¼š
â€¢ æµ‹è¯•ä¸åŒæœ¨æçš„å¼ºåº¦
â€¢ æ¯”è¾ƒä¸åŒæˆªé¢å½¢çŠ¶çš„æ‰¿è½½èƒ½åŠ›
â€¢ è§‚å¯Ÿææ–™çš„ç ´åæ¨¡å¼`
    }

    // è®¾è®¡æ–¹æ³•ç›¸å…³
    if (lowerQuestion.includes('è®¾è®¡') || lowerQuestion.includes('æ–¹æ¡ˆ') || lowerQuestion.includes('æ„æ€') || lowerQuestion.includes('åˆ›æ„')) {
      return `æ¡¥æ¢è®¾è®¡æ–¹æ³•ï¼š

ğŸ¨ **è®¾è®¡æµç¨‹**ï¼š
1. **éœ€æ±‚åˆ†æ**ï¼šç¡®å®šè·¨åº¦ã€è·è½½ã€ç¯å¢ƒ
2. **æ–¹æ¡ˆæ„æ€**ï¼šæå‡ºå¤šç§è®¾è®¡æ–¹æ¡ˆ
3. **ç»“æ„åˆ†æ**ï¼šè®¡ç®—å—åŠ›æƒ…å†µ
4. **ä¼˜åŒ–æ”¹è¿›**ï¼šè°ƒæ•´è®¾è®¡å‚æ•°
5. **æ–½å·¥è®¾è®¡**ï¼šè€ƒè™‘æ–½å·¥å¯è¡Œæ€§

ğŸ’¡ **è®¾è®¡åŸåˆ™**ï¼š
â€¢ **å®‰å…¨ç¬¬ä¸€**ï¼šç¡®ä¿ç»“æ„å®‰å…¨å¯é 
â€¢ **ç»æµåˆç†**ï¼šåœ¨æ»¡è¶³åŠŸèƒ½çš„å‰æä¸‹é™ä½æˆæœ¬
â€¢ **ç¾è§‚å®ç”¨**ï¼šå…¼é¡¾ç»“æ„ç¾å’Œå®ç”¨æ€§
â€¢ **æ–½å·¥å¯è¡Œ**ï¼šè€ƒè™‘å®é™…æ–½å·¥æ¡ä»¶

ğŸš€ **åˆ›æ–°æ€ç»´**ï¼š
â€¢ ä»è‡ªç„¶ç•Œå¯»æ‰¾çµæ„Ÿ
â€¢ å°è¯•æ–°ææ–™å’Œæ–°å·¥è‰º
â€¢ è€ƒè™‘ç¯ä¿å’Œå¯æŒç»­å‘å±•`
    }

    // å®éªŒç›¸å…³
    if (lowerQuestion.includes('å®éªŒ') || lowerQuestion.includes('æµ‹è¯•') || lowerQuestion.includes('éªŒè¯') || lowerQuestion.includes('åˆ¶ä½œ')) {
      return `å®éªŒè®¾è®¡ä¸å®æ–½ï¼š

ğŸ”¬ **å®éªŒæ­¥éª¤**ï¼š
1. **åˆ¶å®šè®¡åˆ’**ï¼šæ˜ç¡®å®éªŒç›®çš„å’Œæ–¹æ³•
2. **å‡†å¤‡ææ–™**ï¼šé€‰æ‹©åˆé€‚çš„ææ–™å’Œå·¥å…·
3. **åˆ¶ä½œæ¨¡å‹**ï¼šæŒ‰ç…§è®¾è®¡å›¾çº¸åˆ¶ä½œ
4. **åŠ è½½æµ‹è¯•**ï¼šé€æ­¥å¢åŠ è·è½½
5. **è®°å½•æ•°æ®**ï¼šæµ‹é‡å˜å½¢å’Œç ´åè·è½½
6. **åˆ†æç»“æœ**ï¼šå¯¹æ¯”ç†è®ºä¸å®é™…

ğŸ“ **æµ‹é‡è¦ç‚¹**ï¼š
â€¢ ä½¿ç”¨ç²¾ç¡®çš„æµ‹é‡å·¥å…·
â€¢ è®°å½•å…³é”®å°ºå¯¸æ•°æ®
â€¢ è§‚å¯Ÿç ´åè¿‡ç¨‹å’Œæ¨¡å¼
â€¢ æ‹ç…§è®°å½•é‡è¦æ—¶åˆ»

âš ï¸ **å®‰å…¨æ³¨æ„**ï¼š
â€¢ ä½©æˆ´é˜²æŠ¤ç”¨å“
â€¢ æ§åˆ¶åŠ è½½é€Ÿåº¦
â€¢ æ³¨æ„è§‚å¯Ÿå¼‚å¸¸æƒ…å†µ
â€¢ åŠæ—¶åœæ­¢å±é™©æ“ä½œ`
    }

    // å­¦ä¹ å»ºè®®ç›¸å…³
    if (lowerQuestion.includes('å­¦ä¹ ') || lowerQuestion.includes('å»ºè®®') || lowerQuestion.includes('æ–¹æ³•') || lowerQuestion.includes('æŠ€å·§')) {
      return `å­¦ä¹ å»ºè®®å’Œæ–¹æ³•ï¼š

ğŸ“š **å­¦ä¹ ç­–ç•¥**ï¼š
â€¢ **ç†è®ºç»“åˆå®è·µ**ï¼šå…ˆå­¦åŸç†ï¼Œå†åšå®éªŒ
â€¢ **å¾ªåºæ¸è¿›**ï¼šä»ç®€å•åˆ°å¤æ‚
â€¢ **å¤šåŠ¨æ‰‹**ï¼šé€šè¿‡åˆ¶ä½œåŠ æ·±ç†è§£
â€¢ **å¤šæ€è€ƒ**ï¼šåˆ†æå¤±è´¥åŸå› ï¼Œæ€»ç»“ç»éªŒ

ğŸ¯ **å­¦ä¹ é‡ç‚¹**ï¼š
1. **ç»“æ„åŸç†**ï¼šç†è§£åŠ›çš„ä¼ é€’è·¯å¾„
2. **ææ–™ç‰¹æ€§**ï¼šæŒæ¡ä¸åŒææ–™çš„ç‰¹ç‚¹
3. **è®¾è®¡æ–¹æ³•**ï¼šå­¦ä¼šç³»ç»ŸåŒ–è®¾è®¡æ€ç»´
4. **å®éªŒæŠ€èƒ½**ï¼šæé«˜åŠ¨æ‰‹æ“ä½œèƒ½åŠ›

ğŸ’ª **æå‡æŠ€å·§**ï¼š
â€¢ å¤šåšç»ƒä¹ é¢˜å’Œè®¾è®¡é¢˜
â€¢ å‚åŠ è®¾è®¡ç«èµ›
â€¢ ä¸åŒå­¦äº¤æµè®¨è®º
â€¢ å…³æ³¨å·¥ç¨‹æ¡ˆä¾‹

è®°ä½ï¼šå¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯ï¼Œæ¯æ¬¡å¤±è´¥éƒ½æ˜¯å­¦ä¹ çš„æœºä¼šï¼`
    }

    // å·¥ç¨‹æ¡ˆä¾‹ç›¸å…³
    if (lowerQuestion.includes('æ¡ˆä¾‹') || lowerQuestion.includes('ä¾‹å­') || lowerQuestion.includes('å®ä¾‹') || lowerQuestion.includes('è‘—å')) {
      return `è‘—åæ¡¥æ¢å·¥ç¨‹æ¡ˆä¾‹ï¼š

ğŸŒ‰ **ä¸–ç•Œè‘—åæ¡¥æ¢**ï¼š
â€¢ **é‡‘é—¨å¤§æ¡¥**ï¼šæ‚¬ç´¢æ¡¥çš„ç»å…¸ä¹‹ä½œ
â€¢ **æ‚‰å°¼æµ·æ¸¯å¤§æ¡¥**ï¼šæ‹±æ¡¥çš„ä»£è¡¨ä½œå“
â€¢ **æ˜çŸ³æµ·å³¡å¤§æ¡¥**ï¼šä¸–ç•Œæœ€é•¿çš„æ‚¬ç´¢æ¡¥
â€¢ **èµµå·æ¡¥**ï¼šä¸­å›½å¤ä»£çŸ³æ‹±æ¡¥çš„æ°ä½œ

ğŸ“– **å­¦ä¹ ä»·å€¼**ï¼š
â€¢ äº†è§£ä¸åŒç»“æ„å½¢å¼çš„ç‰¹ç‚¹
â€¢ å­¦ä¹ å·¥ç¨‹è®¾è®¡çš„åˆ›æ–°æ€ç»´
â€¢ è®¤è¯†ææ–™ä¸ç»“æ„çš„å…³ç³»
â€¢ ä½“ä¼šå·¥ç¨‹ä¸è‰ºæœ¯çš„ç»“åˆ

ğŸ” **åˆ†ææ–¹æ³•**ï¼š
â€¢ ç ”ç©¶æ¡¥æ¢çš„ç»“æ„å½¢å¼
â€¢ åˆ†æå—åŠ›ç‰¹ç‚¹å’Œä¼ åŠ›è·¯å¾„
â€¢ äº†è§£æ–½å·¥æŠ€æœ¯å’Œåˆ›æ–°ç‚¹
â€¢ æ€è€ƒè®¾è®¡çš„ä¼˜ç¼ºç‚¹

å»ºè®®å¤šç ”ç©¶è¿™äº›ç»å…¸æ¡ˆä¾‹ï¼Œä»ä¸­æ±²å–è®¾è®¡çµæ„Ÿï¼`
    }

    // æ•°å­¦è®¡ç®—ç›¸å…³
    if (lowerQuestion.includes('è®¡ç®—') || lowerQuestion.includes('å…¬å¼') || lowerQuestion.includes('æ•°å­¦') || lowerQuestion.includes('ç®—æ³•')) {
      return `æ¡¥æ¢è®¡ç®—åŸºç¡€çŸ¥è¯†ï¼š

ğŸ§® **åŸºæœ¬å…¬å¼**ï¼š
â€¢ **å¼¯çŸ©**ï¼šM = P Ã— L / 4 (ç®€æ”¯æ¢ä¸­ç‚¹é›†ä¸­è·è½½)
â€¢ **åº”åŠ›**ï¼šÏƒ = M Ã— y / I
â€¢ **æŒ åº¦**ï¼šf = 5PLÂ³ / (384EI)
â€¢ **å®‰å…¨ç³»æ•°**ï¼šn = Ïƒu / Ïƒ

ğŸ“ **è®¡ç®—æ­¥éª¤**ï¼š
1. ç¡®å®šè·è½½å’Œè·¨åº¦
2. è®¡ç®—å†…åŠ›ï¼ˆå¼¯çŸ©ã€å‰ªåŠ›ï¼‰
3. é€‰æ‹©æˆªé¢å°ºå¯¸
4. éªŒç®—å¼ºåº¦å’Œåˆšåº¦
5. è°ƒæ•´è®¾è®¡å‚æ•°

ğŸ’¡ **è®¡ç®—æŠ€å·§**ï¼š
â€¢ ä½¿ç”¨å•ä½åˆ¶è¦ç»Ÿä¸€
â€¢ æ³¨æ„å…¬å¼çš„é€‚ç”¨æ¡ä»¶
â€¢ è€ƒè™‘å®‰å…¨ç³»æ•°
â€¢ éªŒè¯è®¡ç®—ç»“æœçš„åˆç†æ€§

å»ºè®®å…ˆç”¨ç®€å•ä¾‹å­ç»ƒä¹ è®¡ç®—ï¼Œå†é€æ­¥å¢åŠ å¤æ‚åº¦ï¼`
    }

    // é»˜è®¤å›ç­” - æ›´æ™ºèƒ½çš„é€šç”¨å›ç­”
    return `æ„Ÿè°¢æ‚¨çš„æé—®ï¼ğŸ¤”

è™½ç„¶æ‚¨çš„é—®é¢˜å¯èƒ½è¶…å‡ºäº†æˆ‘é¢„è®¾çš„ä¸“ä¸šçŸ¥è¯†èŒƒå›´ï¼Œä½†æˆ‘å¯ä»¥å°è¯•ä»æ¡¥æ¢å·¥ç¨‹çš„è§’åº¦ä¸ºæ‚¨åˆ†æï¼š

ğŸ” **å»ºè®®æ‚¨**ï¼š
â€¢ å°†é—®é¢˜ä¸æ¡¥æ¢å·¥ç¨‹è”ç³»èµ·æ¥
â€¢ æä¾›æ›´å…·ä½“çš„æŠ€æœ¯ç»†èŠ‚
â€¢ è¯´æ˜æ‚¨é‡åˆ°çš„å…·ä½“å›°éš¾

ğŸ“š **æˆ‘å¯ä»¥å¸®åŠ©æ‚¨**ï¼š
â€¢ æ¡¥æ¢è®¾è®¡åŸç†åˆ†æ
â€¢ ç»“æ„åŠ›å­¦è®¡ç®—æŒ‡å¯¼  
â€¢ ææ–™é€‰æ‹©å»ºè®®
â€¢ å®éªŒè®¾è®¡æ–¹æ³•
â€¢ å­¦ä¹ ç­–ç•¥åˆ¶å®š

ğŸ’¡ **æˆ–è€…æ‚¨å¯ä»¥å°è¯•**ï¼š
â€¢ è¯¢é—®å…·ä½“çš„æ¡¥æ¢ç±»å‹
â€¢ äº†è§£ææ–™ç‰¹æ€§
â€¢ å­¦ä¹ è®¾è®¡æ–¹æ³•
â€¢ æ¢è®¨å®éªŒæŠ€å·§

è¯·å‘Šè¯‰æˆ‘æ‚¨å…·ä½“æƒ³äº†è§£ä»€ä¹ˆï¼Œæˆ‘ä¼šå°½åŠ›ä¸ºæ‚¨æä¾›ä¸“ä¸šçš„è§£ç­”ï¼`
  }

  const handleSendMessage = async () => {
    if (!inputMessage.trim()) return

    const userMessage = {
      content: inputMessage,
      isUser: true,
    }
    
    addChatMessage(userMessage)
    const currentMessage = inputMessage
    setInputMessage('')
    setIsTyping(true)

    try {
      // è°ƒç”¨AI APIï¼Œä¼ é€’å†å²æ¶ˆæ¯ä»¥æ”¯æŒä¸Šä¸‹æ–‡å¯¹è¯
      // åªä¼ é€’æœ€è¿‘çš„å¯¹è¯å†å²ï¼ˆæœ€å¤š10è½®ï¼‰ä»¥é¿å…è¯·æ±‚è¿‡å¤§
      const recentHistory = chatMessages.slice(-10).map(msg => ({
        content: msg.content,
        isUser: msg.isUser,
      }))
      
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
          message: currentMessage,
          history: recentHistory,
        }),
      })

      if (!response.ok) {
        throw new Error('API request failed')
      }

      const data = await response.json()
      const aiResponse = data.response || getAIResponse(currentMessage)
      
      addChatMessage({
        content: aiResponse,
        isUser: false,
      })
    } catch (error) {
      console.error('AI API Error:', error)
      // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å›ç­”
      const aiResponse = getAIResponse(currentMessage)
      
      addChatMessage({
        content: aiResponse,
        isUser: false,
      })
    }
    
    setIsTyping(false)
  }

  const handleQuickQuestion = (question: string) => {
    setInputMessage(question)
  }

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault()
      handleSendMessage()
    }
  }

  // è·å–å­¦ä¹ å»ºè®®
  const getLearningSuggestions = (): string[] => {
    const suggestions = []
    const recentMessages = chatMessages.slice(-10) // æœ€è¿‘10æ¡æ¶ˆæ¯
    
    // åˆ†æç”¨æˆ·å…³æ³¨çš„è¯é¢˜
    const topics = recentMessages
      .filter(msg => msg.isUser)
      .map(msg => msg.content.toLowerCase())
      .join(' ')
    
    if (topics.includes('æ¡¥æ¢') && topics.includes('ç±»å‹')) {
      suggestions.push('å»ºè®®å­¦ä¹ ä¸åŒæ¡¥æ¢ç±»å‹çš„å—åŠ›ç‰¹ç‚¹')
    }
    if (topics.includes('è®¡ç®—') || topics.includes('æ‰¿é‡')) {
      suggestions.push('å¯ä»¥å°è¯•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ¢æ¡¥è¿›è¡Œæ‰¿é‡æµ‹è¯•')
    }
    if (topics.includes('ææ–™') || topics.includes('æœ¨æ')) {
      suggestions.push('å»ºè®®æ¯”è¾ƒä¸åŒæœ¨æçš„å¼ºåº¦å’Œæˆæœ¬')
    }
    if (topics.includes('ç¨³å®š') || topics.includes('ä¼˜åŒ–')) {
      suggestions.push('å¯ä»¥å°è¯•æ·»åŠ æ–œæ’‘æ¥æé«˜ç»“æ„ç¨³å®šæ€§')
    }
    
    // é»˜è®¤å»ºè®®
    if (suggestions.length === 0) {
      suggestions.push('å»ºè®®ä»ç®€å•çš„æ¢æ¡¥è®¾è®¡å¼€å§‹å­¦ä¹ ')
      suggestions.push('å¯ä»¥å°è¯•è®¡ç®—ä¸åŒè·¨åº¦çš„ææ–™ç”¨é‡')
    }
    
    return suggestions.slice(0, 3) // æœ€å¤šæ˜¾ç¤º3ä¸ªå»ºè®®
  }

  return (
    <div className="p-6">
      <div className="mb-6">
        <h2 className="text-2xl font-bold text-gray-900 mb-2">æ™ºèƒ½å­¦ä¹ åŠ©æ‰‹</h2>
        <p className="text-gray-600">æˆ‘å¯ä»¥å›ç­”æ‚¨å…³äºæ¡¥æ¢è®¾è®¡ã€ç»“æ„åŠ›å­¦å’Œæœ¨ç»“æ„å·¥ç¨‹çš„é—®é¢˜</p>
      </div>

      {/* å¿«é€Ÿé—®é¢˜ */}
      <div className="mb-6">
        <h3 className="text-sm font-medium text-gray-700 mb-3">å¿«é€Ÿæé—®</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
          {quickQuestions.map((item, index) => {
            const Icon = item.icon
            return (
              <button
                key={index}
                onClick={() => handleQuickQuestion(item.text)}
                className="flex items-center space-x-3 p-3 text-left bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <Icon className="w-5 h-5 text-primary-600 flex-shrink-0" />
                <div className="min-w-0 flex-1">
                  <div className="text-sm font-medium text-gray-900 truncate">{item.text}</div>
                  <div className="text-xs text-gray-500">{item.category}</div>
                </div>
              </button>
            )
          })}
        </div>
      </div>

      {/* èŠå¤©åŒºåŸŸ */}
      <div className="bg-gray-50 rounded-xl p-4 mb-6" style={{ height: '400px', overflowY: 'auto' }}>
        {chatMessages.length === 0 ? (
          <div className="flex items-center justify-center h-full">
            <div className="text-center">
              <Bot className="w-12 h-12 text-gray-400 mx-auto mb-4" />
              <h3 className="text-lg font-medium text-gray-900 mb-2">å¼€å§‹å¯¹è¯</h3>
              <p className="text-gray-500">é€‰æ‹©ä¸Šæ–¹é—®é¢˜æˆ–ç›´æ¥è¾“å…¥æ‚¨çš„é—®é¢˜</p>
            </div>
          </div>
        ) : (
          <div className="space-y-4">
            {chatMessages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.isUser ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`flex items-start space-x-3 max-w-3xl ${
                    message.isUser ? 'flex-row-reverse space-x-reverse' : ''
                  }`}
                >
                  <div
                    className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                      message.isUser
                        ? 'bg-primary-600 text-white'
                        : 'bg-white text-primary-600 border border-primary-200'
                    }`}
                  >
                    {message.isUser ? <User className="w-4 h-4" /> : <Bot className="w-4 h-4" />}
                  </div>
                  <div
                    className={`px-4 py-3 rounded-2xl ${
                      message.isUser
                        ? 'bg-primary-600 text-white'
                        : 'bg-white text-gray-900 border border-gray-200'
                    }`}
                  >
                    <div className="whitespace-pre-wrap text-sm">{message.content}</div>
                    <div className={`text-xs mt-1 ${
                      message.isUser ? 'text-primary-100' : 'text-gray-500'
                    }`}>
                      {message.timestamp.toLocaleTimeString()}
                    </div>
                  </div>
                </div>
              </div>
            ))}
            
            {isTyping && (
              <div className="flex justify-start">
                <div className="flex items-start space-x-3">
                  <div className="w-8 h-8 rounded-full bg-white text-primary-600 border border-primary-200 flex items-center justify-center">
                    <Bot className="w-4 h-4" />
                  </div>
                  <div className="bg-white border border-gray-200 rounded-2xl px-4 py-3">
                    <div className="flex space-x-1">
                      <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                      <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                      <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                    </div>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>
        )}
      </div>

      {/* è¾“å…¥åŒºåŸŸ */}
      <div className="flex space-x-3">
        <div className="flex-1">
          <textarea
            value={inputMessage}
            onChange={(e) => setInputMessage(e.target.value)}
            onKeyPress={handleKeyPress}
            placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..."
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none"
            rows={2}
          />
        </div>
        <button
          onClick={handleSendMessage}
          disabled={!inputMessage.trim() || isTyping}
          className="btn-primary flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <Send className="w-4 h-4" />
          <span>å‘é€</span>
        </button>
      </div>

      {/* å­¦ä¹ å»ºè®® */}
      {chatMessages.length > 0 && (
        <div className="mt-4 p-4 bg-green-50 rounded-lg">
          <div className="flex items-start space-x-3">
            <Lightbulb className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-green-800">
              <p className="font-medium mb-2">ğŸ¯ ä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®</p>
              <ul className="space-y-1">
                {getLearningSuggestions().map((suggestion, index) => (
                  <li key={index} className="flex items-start space-x-2">
                    <span className="text-green-600">â€¢</span>
                    <span>{suggestion}</span>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>
      )}

      {/* å¸®åŠ©æç¤º */}
      <div className="mt-4 p-4 bg-blue-50 rounded-lg">
        <div className="flex items-start space-x-3">
          <HelpCircle className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
          <div className="text-sm text-blue-800">
            <p className="font-medium mb-1">ğŸ’¡ å­¦ä¹ æç¤º</p>
            <p>æ‚¨å¯ä»¥è¯¢é—®å…³äºæ¡¥æ¢è®¾è®¡ã€ç»“æ„åŠ›å­¦ã€ææ–™é€‰æ‹©ã€æ‰¿é‡è®¡ç®—ç­‰ä»»ä½•é—®é¢˜ã€‚æˆ‘ä¼šæ ¹æ®æ‚¨çš„å­¦ä¹ è¿›åº¦æä¾›ä¸ªæ€§åŒ–çš„è§£ç­”å’Œå»ºè®®ã€‚</p>
          </div>
        </div>
      </div>
    </div>
  )
}
